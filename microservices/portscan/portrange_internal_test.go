package main

import "testing"

func TestSplitPortsSinglePort(t *testing.T) {
	portRange := "80"
	ports, err := SplitPorts(portRange, ",", "-")

	if err != nil {
		t.Fatal(err.Error())
	}

	if len(ports) == 0 || len(ports) > 1 {
		t.Fatalf("Expected array of size 1, but was %d", len(ports))
	}

	if ports[0] != 80 {
		t.Fatalf("Expected value of 80, but got %d", ports[0])
	}
}

func TestSplitPortsPortRange(t *testing.T) {
	portRange := "80-85"
	ports, err := SplitPorts(portRange, ",", "-")

	if err != nil {
		t.Fatal(err.Error())
	}

	if len(ports) == 0 || len(ports) > 6 {
		t.Fatalf("Expected array of size 6, but was %d", len(ports))
	}

	if ports[2] != 82 {
		t.Errorf("Expected port 82, but got %d", ports[0])
	}
}

func TestSplitPorts(t *testing.T) {
	portRange := "80,81,82,83-9999"
	ports, err := SplitPorts(portRange, ",", "-")

	if err != nil {
		t.Fatal(err.Error())
	}

	if len(ports) != 9920 {
		t.Fatalf("Expected array of size 9920, but was %d", len(ports))
	}

	if ports[4] != 84 {
		t.Errorf("Expected 84, but was %d instead.", ports[4])
	}
}

func BenchmarkSinglePortSplit(b *testing.B) {
	portRange := "80"
	for i := 0; i < b.N; i++ {
		SplitPorts(portRange, ",", "-")
	}
}

func BenchmarkSplitPortsPortRange(b *testing.B) {
	portRange := "80-85"
	for i := 0; i < b.N; i++ {
		SplitPorts(portRange, ",", "-")
	}
}

func BenchmarkSplitPorts(b *testing.B) {
	portRange := "80,81,82,83-9999"
	for i := 0; i < b.N; i++ {
		SplitPorts(portRange, ",", "-")
	}
}
